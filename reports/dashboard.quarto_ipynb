{
  "cells": [
    {
      "cell_type": "markdown",
      "metadata": {},
      "source": [
        "---\n",
        "title: \"LS_BS_4th_6ì¡° - Ames Housing í™”ì¬ ë¦¬ìŠ¤í¬ ë¶„ì„\"\n",
        "format:\n",
        "  dashboard:\n",
        "    theme: morph\n",
        "    logo: images/beetle.png\n",
        "    sidebar: true\n",
        "    page-navigation: true\n",
        "    reader-mode: false\n",
        "    nav-buttons:\n",
        "      - icon: github\n",
        "        href: https://github.com/your-repo-link\n",
        "      - icon: globe\n",
        "        href: https://your-site-link\n",
        "---\n",
        "\n",
        "\n",
        "## ğŸ“„ 2025.4.22 íšŒì˜ë¡ â€“ ì£¼íƒ í™”ì¬ ë¦¬ìŠ¤í¬ ë° ë³´í—˜ê¸ˆ ì˜ˆì¸¡ ëª¨ë¸ë§\n",
        "\n",
        "**ì£¼ì œ:** ì‹¬ìŠ¨ ê°€ì¡±ì´ Amesì— ì§‘ì„ ìƒ€ì„ ë•Œ, í™”ì¬ ë°œìƒ ì‹œ ë³´í—˜ê¸ˆì€ ì–¼ë§ˆì¼ê¹Œ?\n",
        "\n",
        "---\n",
        "\n",
        "## ğŸ”¹ 0. ì¸íŠ¸ë¡œ â€“ ëœë¤ ì…ì£¼ & ë¬¸ì œ ì œê¸°\n"
      ],
      "id": "2f473796"
    },
    {
      "cell_type": "code",
      "metadata": {},
      "source": [
        "import pandas as pd\n",
        "import numpy as np\n",
        "np.random.seed(2025)\n",
        "dataloader = DataLoader()\n",
        "dataset = dataloader.load_data()\n",
        "df = dataset\n",
        "simpsons_home = df.sample(1)\n",
        "simpsons_home[[\"Neighborhood\", \"YearBuilt\", \"SalePrice\"]]"
      ],
      "id": "cd311da9",
      "execution_count": null,
      "outputs": []
    },
    {
      "cell_type": "markdown",
      "metadata": {},
      "source": [
        "---\n",
        "\n",
        "## ğŸ”¹ 1. í™”ì¬ ìœ„í—˜ ì§€ì—­ ì‹œê°í™” {.tabset}\n",
        "\n",
        "### ğŸ”§ í™”ì¬ ìœ„í—˜ ì ìˆ˜ ìƒì„±"
      ],
      "id": "bd619468"
    },
    {
      "cell_type": "code",
      "metadata": {},
      "source": [
        "def assign_risk(exterior):\n",
        "    if exterior in ['Wd Sdng', 'WdShing', 'Plywood']: return 'High'\n",
        "    elif exterior in ['VinylSd', 'MetalSd']: return 'Medium'\n",
        "    return 'Low'\n",
        "\n",
        "df['FireRiskGrade'] = df['Exterior1st'].apply(assign_risk)\n",
        "df['FireRiskScore'] = df['FireRiskGrade'].map({'Low': 1, 'Medium': 2, 'High': 3})"
      ],
      "id": "1f0ac6b3",
      "execution_count": null,
      "outputs": []
    },
    {
      "cell_type": "markdown",
      "metadata": {},
      "source": [
        "### ğŸ§ª ì§€ì—­ë³„ ìœ„í—˜ë„ í†µê³„ ê²€ì •"
      ],
      "id": "5cee631b"
    },
    {
      "cell_type": "code",
      "metadata": {},
      "source": [
        "from scipy.stats import ttest_ind\n",
        "df_low = df[df.FireRiskGrade == 'Low']\n",
        "df_high = df[df.FireRiskGrade == 'High']\n",
        "ttest_ind(df_low['SalePrice'], df_high['SalePrice'])"
      ],
      "id": "013a4e54",
      "execution_count": null,
      "outputs": []
    },
    {
      "cell_type": "markdown",
      "metadata": {},
      "source": [
        "### ğŸ—ºï¸ ì§€ë„ ì‹œê°í™” (Plotly ì˜ˆì‹œ)"
      ],
      "id": "3dc1d5d0"
    },
    {
      "cell_type": "code",
      "metadata": {},
      "source": [
        "import plotly.express as px\n",
        "fig = px.scatter_mapbox(df, lat=\"Latitude\", lon=\"Longitude\",\n",
        "                         color=\"FireRiskGrade\", mapbox_style=\"open-street-map\",\n",
        "                         zoom=11, title=\"í™”ì¬ ìœ„í—˜ ë“±ê¸‰ë³„ ìœ„ì¹˜ ì‹œê°í™”\")\n",
        "fig.show()"
      ],
      "id": "77830a73",
      "execution_count": null,
      "outputs": []
    },
    {
      "cell_type": "markdown",
      "metadata": {},
      "source": [
        "---\n",
        "\n",
        "## ğŸ”¹ 2. í™”ì¬ ëŒ€ì‘ ìì› ë¶„í¬ ë¶„ì„\n"
      ],
      "id": "717d2172"
    },
    {
      "cell_type": "code",
      "metadata": {},
      "source": [
        "df['ResourceScore'] = (\n",
        "    (df['PoolArea'] > 0).astype(int) +\n",
        "    (df['Fireplaces'] > 0).astype(int) +\n",
        "    (df['GarageCars'] > 0).astype(int) +\n",
        "    (df['FullBath'] > 0).astype(int)\n",
        ")"
      ],
      "id": "e1f362eb",
      "execution_count": null,
      "outputs": []
    },
    {
      "cell_type": "code",
      "metadata": {},
      "source": [
        "fig = px.box(df, x=\"FireRiskGrade\", y=\"ResourceScore\",\n",
        "             title=\"ìœ„í—˜ ë“±ê¸‰ë³„ ìì› ì ìˆ˜ Boxplot\")\n",
        "fig.show()"
      ],
      "id": "b5b07b4c",
      "execution_count": null,
      "outputs": []
    },
    {
      "cell_type": "markdown",
      "metadata": {},
      "source": [
        "---\n",
        "\n",
        "## ğŸ”¹ 3. í”¼í•´ì•¡ ì˜ˆì¸¡ ëª¨ë¸ë§"
      ],
      "id": "290fccd5"
    },
    {
      "cell_type": "code",
      "metadata": {},
      "source": [
        "from sklearn.linear_model import LinearRegression\n",
        "from sklearn.model_selection import train_test_split\n",
        "X = df[[\"FireRiskScore\", \"GrLivArea\", \"YearBuilt\", \"OverallQual\"]]\n",
        "y = df[\"SalePrice\"] * 0.3\n",
        "X_train, X_test, y_train, y_test = train_test_split(X, y, random_state=42)\n",
        "model = LinearRegression().fit(X_train, y_train)\n",
        "df['ExpectedDamage'] = model.predict(X)"
      ],
      "id": "93f4eb7f",
      "execution_count": null,
      "outputs": []
    },
    {
      "cell_type": "markdown",
      "metadata": {},
      "source": [
        "### âš  ëª¨ì§‘ë‹¨ ëŒ€í‘œì„± ê²€ì •"
      ],
      "id": "e8fda252"
    },
    {
      "cell_type": "code",
      "metadata": {},
      "source": [
        "pop_mean = 180000\n",
        "sample_mean = df['SalePrice'].mean()\n",
        "std = df['SalePrice'].std()\n",
        "n = len(df)\n",
        "z = (sample_mean - pop_mean) / (std / np.sqrt(n))\n",
        "z"
      ],
      "id": "27d7794a",
      "execution_count": null,
      "outputs": []
    },
    {
      "cell_type": "markdown",
      "metadata": {},
      "source": [
        "---\n",
        "\n",
        "## ğŸ”¹ 4. ì˜ˆìƒ ë³´í—˜ê¸ˆ ì‚°ì •"
      ],
      "id": "ec563a6c"
    },
    {
      "cell_type": "code",
      "metadata": {},
      "source": [
        "def insurance_calc(row):\n",
        "    risk_weight = {'High': 1.2, 'Medium': 1.0, 'Low': 0.8}[row['FireRiskGrade']]\n",
        "    resource_weight = 0.9 if row['ResourceScore'] >= 3 else 1.0\n",
        "    aging_weight = 1.2 if (2025 - row['YearBuilt']) > 30 else 1.0\n",
        "    return row['ExpectedDamage'] * risk_weight * resource_weight * aging_weight\n",
        "\n",
        "df['ExpectedInsurance'] = df.apply(insurance_calc, axis=1)"
      ],
      "id": "88b30e02",
      "execution_count": null,
      "outputs": []
    },
    {
      "cell_type": "code",
      "metadata": {},
      "source": [
        "fig = px.histogram(df, x=\"ExpectedInsurance\", nbins=30,\n",
        "                   title=\"ì˜ˆìƒ ë³´í—˜ê¸ˆ ë¶„í¬\")\n",
        "fig.show()"
      ],
      "id": "49ec35fd",
      "execution_count": null,
      "outputs": []
    },
    {
      "cell_type": "markdown",
      "metadata": {},
      "source": [
        "---\n",
        "\n",
        "## ğŸ”¹ 5. ê²°ë¡  ë° ë³´í—˜ê¸ˆ ì‚°ì¶œ ê²°ê³¼ ì •ë¦¬ {.column width=100%}\n"
      ],
      "id": "98105e86"
    },
    {
      "cell_type": "code",
      "metadata": {},
      "source": [
        "df['RiskScore'] = df['ExpectedDamage'] / df['ExpectedInsurance']\n",
        "df.sort_values(by='ExpectedInsurance', ascending=False).head(5)[[\"Neighborhood\", \"SalePrice\", \"ExpectedDamage\", \"ExpectedInsurance\"]]"
      ],
      "id": "2330e05a",
      "execution_count": null,
      "outputs": []
    },
    {
      "cell_type": "markdown",
      "metadata": {},
      "source": [
        "::: {.card title=\"ğŸ“Œ ë¶„ì„ ìš”ì•½\"}\n",
        "- ì‹¬ìŠ¨ ê°€ì¡±ì˜ ì£¼íƒì„ í¬í•¨í•œ í™”ì¬ ë¦¬ìŠ¤í¬ ë° ë³´í—˜ê¸ˆ ì˜ˆì¸¡ ê²°ê³¼ ì •ë¦¬\n",
        "- ì˜ˆìƒ í”¼í•´ì•¡ê³¼ ì£¼íƒ íŠ¹ì„± ê¸°ë°˜ ë³´í—˜ê¸ˆ ì‚°ì¶œ ì™„ë£Œ\n",
        ":::\n",
        "\n",
        "> â€œìš°ë¦¬ê°€ ì˜ˆì¸¡í•œ ë³´í—˜ê¸ˆê³¼ ìœ„í—˜ë„ë¥¼ ê¸°ë°˜ìœ¼ë¡œ,\n",
        "> ë³´ë‹¤ ì•ˆì „í•˜ê³  í•©ë¦¬ì ì¸ ë³´í—˜ ì •ì±… ì„¤ê³„ ë° ì£¼íƒ ì„ íƒì— ë„ì›€ì„ ì¤„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.â€"
      ],
      "id": "fa27a33a"
    }
  ],
  "metadata": {
    "kernelspec": {
      "name": "python3",
      "language": "python",
      "display_name": "Python 3 (ipykernel)",
      "path": "C:\\Users\\USER\\AppData\\Roaming\\Python\\share\\jupyter\\kernels\\python3"
    }
  },
  "nbformat": 4,
  "nbformat_minor": 5
}